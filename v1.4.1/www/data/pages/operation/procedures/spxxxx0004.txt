====== Procedimiento Especial - Perdida de Conexion Con la Monitorización ======



===== Datos Generales  =====


|< 50% >|
^  Código      ^  Nombre Procedimiento                                              ^  Verificado                  ^  Operativo                   ^  Fecha Creación  ^  Fecha Ultima Modificación  ^  Versión  ^

===== Alcance  =====

|< 50% >|
^  ACTOR          ^  EJECUCION                   ^  HORARIO EJECUCION                                                                     ^
|  BULL MADRID    |  @#EAFFD5:SI                 |  @#FFFF00: INTERVENCION SOLICITADA                                                     |

===== Notificación Inicial =====

  - Notificar la incidencia a los siguientes actores:
===== Procedimiento  =====

<hidden Situación A. En caso de no disponer de conexión con la monitorización>
  - Verificar la conectividad con los nodos externos<code>
ping 172.24.29.90 ## [MANAGEMENT NODES] ## Gestion
ping 172.24.29.91 ## [MANAGEMENT NODES] ## Gestion
ping 172.24.8.220 ## [LOGIN NODES] ## Login
ping 172.24.8.223 ## [LOGIN NODES] ## Login
ping 172.24.8.224 ## [LOGIN NODES] ## IO
ping 172.24.8.226 ## [LOGIN NODES] ## IO
</code>
  - En Caso de que ninguno responda:
      - En caso correcto
      - En caso negativo
        - Solicitar la intervención de un Técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
    - Dar de alta en ATOS/BULL una incidencia de conectividad para solucionar el problema de la VPN
  - En Caso de que alguno responda pasar a **"situacion B"** o **"situacion C"** según proceda
</hidden>
<hidden Situacion B. Si SI se dispone de conectividad en los nodos de gestion>
<hidden Accion B.1 Conectarse al nodo [MANAGEMENT NODES] de gestion ( En caso afirmativo )>
  - Verificar el estado de:
    - Servicio Cron [[operation:procedures:OSDABS0003|OSDABS0003 : Chequear servicio]]
    - Servicio Apache [[operation:procedures:OSDABS0003|OSDABS0003 : Chequear servicio]]
      - En caso positivo
        - Ejecutar manualmente la monitorización. [[operation:procedures:SFCYBS0001|SFCYBS0001 : Monitorizar el estado de los Nodos]]
          - En caso positivo
            - Notificar a administradores Bull
            - lanzar los siguientes comandos para mantener una monitorización temporal<code>
[MANAGEMENT NODES]#

/opt/cyclops/scripts/cyclops -y drain -c
watch -n 180 "/opt/cyclops/scripts/sensors.nodes.mon.sh -v human -i -m all
</code>
            - ** FINAL **
        - En caso negativo
          - Iniciar el servicio o servicios parados [[operation:procedures:OSDABS0002|OSDABS0002 : Reiniciar servicio]]
            - En caso positivo
            - En caso negativo
              - lanzar el comando watch para mantener una monitorizacion parcial hasta que el problema se solucione<code>
[MANAGEMENT NODES]#

/opt/cyclops/scripts/cyclops -y drain -c
watch -n 180 "/opt/cyclops/scripts/sensors.nodes.mon.sh -v human -i -m all
</code>
              - ** FINAL **
</hidden>
<hidden Accion B.2. Conectarse al nodo [MANAGEMENT NODES] de gestion ( En caso negativo ) >
<hidden Accion B.2.1. Realizar conexion a [MANAGEMENT NODES] ( En caso afirmativo ) >
  - verificar el estado del HA [[operation:procedures:SFPMBS0001|SFPMBS0001 : Chequeo HA Pacemaker]]
    - En caso negativo
      - Verificar el servicio corosync [[operation:procedures:OSDABS0003|OSDABS0003 : Chequear servicio]]
        - En caso positivo
          - Iniciar los servicios parados [[operation:procedures:SFPMBS0009|SFPMBS0009 : Reinicio Servico HA de Pacemaker]]
        - En caso negativo
          - Iniciar el servicio corosync [[operation:procedures:OSDABS0002|OSDABS0002 : Reiniciar servicio]]
          - Verificar que inician los servicios de HA [[operation:procedures:SFPMBS0001|SFPMBS0001 : Chequeo HA Pacemaker]]
          - ** CONTINUAR **
    - En caso positivo
          - ** CONTINUAR ** 
  - verificar el estado del entorno productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
    - En caso negativo
      - recuperar las alarmas activas con sus procedimientos asociados [[operation:procedures:SFCYBS0001|SFCYBS0001 : Chequear el estado de los Nodos]]
    - En caso positivo
      - ** CONTINUAR **
  - verificar la conectividad con [MANAGEMENT NODES] por los tres interfaces posibles (ib0, eth0, eth(ha) ) [[operation:procedures:NTADBS0002|NTADBS0002 : Ethernet Link]]
    - En caso negativo
      - Realizar una conexión a través de consola [[operation:procedures:OSADBS0001|OSADBS0001 : Conexión Remota a Consola Nodo]]
        - En caso negativo
          - Reiniciar el nodo (hard) [[operation:procedures:HRBLBS0002|HRBLBS0002 : Reinicio Nodo]]
          - Re-intentar una conexión a través de consola para controlar el arranque del nodo [[operation:procedures:OSADBS0001|OSADBS0001 : Conexión Remota a Consola Nodo]]
          - Una vez arrancado
            - Verificar el sistema [[operation:procedures:SFCYBS0001|SFCYBS0001 : Chequear el estado de los Nodos]]
            - Verificar el entorno productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
              - En caso positivo
                - ** FINAL **
              - En caso negativo
                - Apagar el nodo [[operation:procedures:HRBLBS0003|HRBLBS0003 : Apagado Nodo]]
                - Solicitar una intervención del técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
                - ** FINAL **  
        - En caso positivo
          - reiniciar el nodo (soft ) [[operation:procedures:HRBLBS0002|HRBLBS0002 : Reinicio Nodo]]
          - Una vez arrancado
            - Verificar el sistema [[operation:procedures:SFCYBS0001|SFCYBS0001 : Monitorizar el estado de los Nodos]]
            - Verificar el entorno productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
              - En caso positivo
                - ** FINAL **
              - En caso negativo
                - Apagar el nodo [[operation:procedures:HRBLBS0003|HRBLBS0003 : Apagado Nodo]]
                - Solicitar una intervención del técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
                - ** FINAL **
    - En caso positivo 
      - Conectarse al nodo por el interfaz que lo permite 
      - Verificar el estado del nodo [[operation:procedures:SFCYBS0001|SFCYBS0001 : Monitorizar el estado de los Nodos]]
        - En caso positivo
          - Reiniciar el nodo (soft) [[operation:procedures:HRBLBS0002|HRBLBS0002 : Reinicio Nodo]]
          - Conectarse a la consola para controlar el arranque del nodo [[operation:procedures:OSADBS0001|OSADBS0001 : Conexión Remota a Consola Nodo]]
          - Una vez que arranque
            - Verificar el nodo [[operation:procedures:SFCYBS0001|SFCYBS0001 : Monitorizar el estado de los Nodos]]
            - Verificar el entorno productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
              - En caso positivo
                - ** FINAL **
              - En caso negativo
                - Apagar el nodo [[operation:procedures:HRBLBS0003|HRBLBS0003 : Apagado Nodo]]
                - Solicitar una intervención del técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
              - ** FINAL **
        - En caso negativo
          - Apagar el nodo [[operation:procedures:HRBLBS0003|HRBLBS0003 : Apagado Nodo]]
          - Solicitar una intervención del técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
          - ** FINAL **
</hidden>
<hidden Accion B.2.2. Realizar conexion a [MANAGEMENT NODES] ( En caso negativo ) >
  * Ir a la Situacion C.
</hidden>
</hidden>
</hidden>
<hidden Situacion C. Si NO se dispone de conectividad en los nodos de gestión >
<hidden Accion C.1. Conectarse a cualquiera de los nodos de login o io (En caso afirmativo) >
      - Verificar internamente la conectividad con MANAGEMENT NODES
        - En caso afirmativo
          - Conectarse al nodo de gestión 
          - Verificar el estado de sus interfaces de red [[operation:procedures:NTADBS0002|NTADBS0002 : Ethernet Link]]
          - Verificar el estado del HA [[operation:procedures:SFPMBS0001|SFPMBS0001 : Chequeo HA Pacemaker]]
          - Verificar el estado del Entorno Productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
        - En caso negativo
          - Solventar el problema detectado 
            - En caso negativo
              - Solicitar la intervención de un técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
            - En caso negativo
              - Verificar el estado de encendido de los nodos [[operation:procedures:HRBLBS0005|HRBLBS0005 : Estado Energetico de un Nodo]]
                - En caso de estar apagado/s
                  - Encender nodo [[operation:procedures:HRBLBS0001|HRBLBS0001 : Encendido Nodo]]
                  - verificar arranque con la consola [[operation:procedures:OSADBS0001|OSADBS0001 : Conexión Remota a Consola Nodo]]
                  - una vez iniciado
                    - verificar nodo [[operation:procedures:SFCYBS0001|SFCYBS0001 : Monitorizar el estado de los Nodos]]
                    - verificar ha [[operation:procedures:SFPMBS0001|SFPMBS0001 : Chequeo HA Pacemaker]]
                    - verificar entorno productivo [[operation:procedures:SFCYAV0001|SFCYAV0001 : Comprobar Entorno Productivo]]
                - En caso de estar encendidos
                    - Solicitar la intervención de un técnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
</hidden>
<hidden Accion C.2. Conectarse a cualquiera de los nodos de login o io (En caso negativo) >
      - Solicitar la intervencion de un Tecnico de guardia [[operation:procedures:ADBMXX0001|ADBMXX0001 : Notificación BULL - Madrid]]
</hidden>